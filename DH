-- üîπ 1Ô∏è‚É£ Load Rayfield and create window
local Rayfield = loadstring(game:HttpGet('https://pastebin.com/raw/yy6ZH1Mq'))()
local Window = Rayfield:CreateWindow({
    Name = "GURTHUB REMASTERED DH",
    LoadingTitle = "Loading...",
    LoadingSubtitle = "by Boxxy",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "RayfieldConfigs",
        FileName = "MyUIConfig"
    },
    KeySystem = true,
    KeySettings = {
        Title = "SECRET PASSWORD",
        Subtitle = "Key System",
        Note = "Yayo's Favorite Bussy?",
        FileName = "Key",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = { "pancake", "Pancake" }
    }
})

-- üîπ 2Ô∏è‚É£ Services & globals
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Debris = game:GetService("Debris")

local localPlayer = Players.LocalPlayer
local liveFolder = Workspace:WaitForChild("Live")

local MAX_RANGE = 200
local MAX_PLAYER_RANGE = 6000
local HP_BAR_MAX_DISTANCE = 150

-- Toggles for ESP & Combat
local PLAYER_ESP_ENABLED = true
local NPC_ESP_ENABLED = true
local SLAYER_COMBAT_ENABLED = false
local DEMON_COMBAT_ENABLED = false

-- Store ESP GUIs
local ESP_GUIS = {}

-- üîπ 3Ô∏è‚É£ Helper function
local function getHealthColor(percent)
    if percent >= 0.7 then
        return Color3.fromRGB(0, 255, 0)
    elseif percent >= 0.3 then
        return Color3.fromRGB(255, 255, 0)
    else
        return Color3.fromRGB(255, 0, 0)
    end
end

-- üîπ 4Ô∏è‚É£ ESP Functions
local function createNPCESP(humanoid)
    local model = humanoid.Parent
    if not model or not model.Name:match("^NPC") then return end
    local head = model:FindFirstChild("Head")
    local hrp = model:FindFirstChild("HumanoidRootPart")
    if not head or not hrp then return end

    if head:FindFirstChild("ESP") then head.ESP:Destroy() end
    local gui = Instance.new("BillboardGui")
    gui.Name = "ESP"
    gui.Adornee = head
    gui.Size = UDim2.fromScale(6, 2)
    gui.StudsOffset = Vector3.new(0,5,0)
    gui.AlwaysOnTop = true
    gui.Enabled = NPC_ESP_ENABLED
    gui.Parent = head
    ESP_GUIS[gui] = true

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromScale(1,0.18)
    bg.BackgroundColor3 = Color3.fromRGB(40,40,40)
    bg.BorderSizePixel = 0
    bg.Parent = gui

    local hp = Instance.new("Frame")
    hp.Size = UDim2.fromScale(1,1)
    hp.BorderSizePixel = 0
    hp.Parent = bg

    local label = Instance.new("TextLabel")
    label.Size = UDim2.fromScale(1,1)
    label.Position = UDim2.fromScale(0,0.25)
    label.BackgroundTransparency = 1
    label.TextSize = 16
    label.FontFace = Font.new("rbxasset://fonts/families/NotoSans.json", Enum.FontWeight.Bold)
    label.TextColor3 = Color3.new(1,1,1)
    label.Parent = gui

    RunService.RenderStepped:Connect(function()
        gui.Enabled = NPC_ESP_ENABLED
        if not localPlayer.Character or not model.Parent then
            gui:Destroy()
            ESP_GUIS[gui] = nil
            return
        end
        local myHRP = localPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not myHRP then return end
        local dist = (myHRP.Position - hrp.Position).Magnitude
        gui.Enabled = NPC_ESP_ENABLED and dist <= MAX_RANGE
        if gui.Enabled then
            local hpPercent = math.clamp(humanoid.Health / humanoid.MaxHealth,0,1)
            hp.Size = UDim2.fromScale(hpPercent,1)
            hp.BackgroundColor3 = getHealthColor(hpPercent)
            label.Text = model.Name.." ["..math.floor(dist).." studs]"
        end
    end)
end

local function createPlayerESP(player, character)
    if player == localPlayer then return end
    local humanoid = character:WaitForChild("Humanoid",5)
    local head = character:WaitForChild("Head",5)
    local hrp = character:WaitForChild("HumanoidRootPart",5)
    if not humanoid or not head or not hrp then return end

    if head:FindFirstChild("ESP") then head.ESP:Destroy() end
    local gui = Instance.new("BillboardGui")
    gui.Name = "ESP"
    gui.Adornee = head
    gui.Size = UDim2.fromOffset(200,55)
    gui.StudsOffset = Vector3.new(0,6,0)
    gui.AlwaysOnTop = true
    gui.Enabled = PLAYER_ESP_ENABLED
    gui.Parent = head
    ESP_GUIS[gui] = true

    local bg = Instance.new("Frame")
    bg.Size = UDim2.fromOffset(170,6)
    bg.Position = UDim2.fromOffset(15,4)
    bg.BackgroundColor3 = Color3.fromRGB(40,40,40)
    bg.BorderSizePixel = 0
    bg.Parent = gui

    local hp = Instance.new("Frame")
    hp.Size = UDim2.fromScale(1,1)
    hp.BorderSizePixel = 0
    hp.Parent = bg

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.fromOffset(200,20)
    nameLabel.Position = UDim2.fromOffset(0,14)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextSize = 15
    nameLabel.TextStrokeTransparency = 0.5
    nameLabel.FontFace = Font.new("rbxasset://fonts/families/NotoSans.json", Enum.FontWeight.Bold)
    nameLabel.TextColor3 = Color3.new(1,1,1)
    nameLabel.Parent = gui

    local distLabel = Instance.new("TextLabel")
    distLabel.Size = UDim2.fromOffset(200,16)
    distLabel.Position = UDim2.fromOffset(0,34)
    distLabel.BackgroundTransparency = 1
    distLabel.TextSize = 16
    distLabel.TextStrokeTransparency = 0.5
    distLabel.FontFace = Font.new("rbxasset://fonts/families/NotoSans.json", Enum.FontWeight.Bold)
    distLabel.TextColor3 = Color3.new(1,1,1)
    distLabel.Parent = gui

    RunService.RenderStepped:Connect(function()
        gui.Enabled = PLAYER_ESP_ENABLED
        if not character.Parent then
            gui:Destroy()
            ESP_GUIS[gui] = nil
            return
        end
        local myHRP = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not myHRP then return end
        local dist = (myHRP.Position - hrp.Position).Magnitude
        gui.Enabled = PLAYER_ESP_ENABLED and dist <= MAX_PLAYER_RANGE
        if gui.Enabled then
            local hpPercent = math.clamp(humanoid.Health / humanoid.MaxHealth,0,1)
            bg.Visible = dist <= HP_BAR_MAX_DISTANCE
            if bg.Visible then
                hp.Size = UDim2.fromScale(hpPercent,1)
                hp.BackgroundColor3 = getHealthColor(hpPercent)
            end
            nameLabel.Text = player.Name.." ["..math.floor(humanoid.Health).." HP]"
            distLabel.Text = dist.." studs"
        end
    end)
end

-- üîπ 5Ô∏è‚É£ Hook ESP
for _, obj in ipairs(liveFolder:GetChildren()) do
    local hum = obj:FindFirstChildWhichIsA("Humanoid")
    if hum then createNPCESP(hum) end
end
liveFolder.ChildAdded:Connect(function(child)
    local hum = child:FindFirstChildWhichIsA("Humanoid")
    if hum then createNPCESP(hum) end
end)
for _, plr in ipairs(Players:GetPlayers()) do
    if plr.Character then
        task.spawn(createPlayerESP, plr, plr.Character)
    end
    plr.CharacterAdded:Connect(function(char)
        task.spawn(createPlayerESP, plr, char)
    end)
end
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function(char)
        task.spawn(createPlayerESP, plr, char)
    end)
end)

-- üîπ 6Ô∏è‚É£ Combat Modes

-- Slayer Combat
local function startSlayerCombat()
    local player = Players.LocalPlayer
    local char = player.Character or player.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    local isSprinting = false
    getgenv().TpWalking = true
    getgenv().Speed = 0.4
    local valuesToRemove = {"isDashing"}
    local delayTime = 0.8

    -- Input
    UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == Enum.KeyCode.LeftShift then
            isSprinting = true
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.LeftShift then
            isSprinting = false
        end
    end)

    local function getSprintMultiplier(hpPercent)
        if hpPercent >= 0.8 then return 1.2
        elseif hpPercent >= 0.6 then return 1.56
        elseif hpPercent >= 0.4 then return 1.92
        elseif hpPercent >= 0.2 then return 2.28
        else return 2.64
        end
    end

    RunService.Heartbeat:Connect(function(dt)
        if not SLAYER_COMBAT_ENABLED then return end
        if not char or not hum or not hum.Parent then return end

        -- Dash cleanup
        for _, child in ipairs(char:GetChildren()) do
            if table.find(valuesToRemove, child.Name) then
                Debris:AddItem(child, delayTime)
            end
        end

        -- TP Walking
        if hum.MoveDirection.Magnitude > 0 then
            local move = hum.MoveDirection * getgenv().Speed * dt
            if isSprinting then
                local hpPercent = hum.Health / hum.MaxHealth
                move *= (6 * getSprintMultiplier(hpPercent))
            end
            char:TranslateBy(move)
        end
    end)

    -- Update on respawn
    player.CharacterAdded:Connect(function(newChar)
        char = newChar
        hum = char:WaitForChild("Humanoid")
    end)
end

-- Demon Combat
local function startDemonCombat()
    local player = Players.LocalPlayer
    local char = player.Character or player.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    local valuesToRemove = {"isDashing"}
    local delayTime = 0.8

    RunService.Heartbeat:Connect(function(dt)
        if not DEMON_COMBAT_ENABLED then return end
        if not char or not hum or not hum.Parent then return end
        for _, child in ipairs(char:GetChildren()) do
            if table.find(valuesToRemove, child.Name) then
                Debris:AddItem(child, delayTime)
            end
        end
    end)

    player.CharacterAdded:Connect(function(newChar)
        char = newChar
        hum = char:WaitForChild("Humanoid")
    end)
end

-- üîπ 7Ô∏è‚É£ Rayfield Tabs / Toggles / Sliders
local ESPTab = Window:CreateTab("ESP", 4483362458)
local CombatTab = Window:CreateTab("Combat", 4483362458)

-- Sections
local PlayerESPSection = ESPTab:CreateSection("Player ESP")
local NPCESPSection = ESPTab:CreateSection("NPC ESP")
local SlayerSection = CombatTab:CreateSection("Slayer Combat")
local DemonSection = CombatTab:CreateSection("Demon Combat")

-- ESP Toggles
ESPTab:CreateToggle({
    Name = "Player ESP (F3)",
    CurrentValue = PLAYER_ESP_ENABLED,
    Flag = "PlayerESP",
    Callback = function(Value)
        PLAYER_ESP_ENABLED = Value
    end
})
ESPTab:CreateToggle({
    Name = "NPC ESP (F4)",
    CurrentValue = NPC_ESP_ENABLED,
    Flag = "NPCESP",
    Callback = function(Value)
        NPC_ESP_ENABLED = Value
    end
})

-- ESP Sliders
ESPTab:CreateSlider({
    Name = "Player ESP Range",
    Range = {500,6000},
    Increment = 100,
    Suffix = "Studs",
    CurrentValue = MAX_PLAYER_RANGE,
    Flag = "PlayerRange",
    Callback = function(Value)
        MAX_PLAYER_RANGE = Value
    end
})
ESPTab:CreateSlider({
    Name = "NPC ESP Range",
    Range = {50,500},
    Increment = 10,
    Suffix = "Studs",
    CurrentValue = MAX_RANGE,
    Flag = "NPCRange",
    Callback = function(Value)
        MAX_RANGE = Value
    end
})
ESPTab:CreateSlider({
    Name = "HP Bar Max Distance",
    Range = {25,300},
    Increment = 5,
    Suffix = "Studs",
    CurrentValue = HP_BAR_MAX_DISTANCE,
    Flag = "HPDistance",
    Callback = function(Value)
        HP_BAR_MAX_DISTANCE = Value
    end
})

-- Combat toggles
CombatTab:CreateToggle({
    Name = "Slayer Combat",
    CurrentValue = SLAYER_COMBAT_ENABLED,
    Flag = "SlayerCombat",
    Callback = function(Value)
        SLAYER_COMBAT_ENABLED = Value
    end
})
CombatTab:CreateToggle({
    Name = "Demon Combat",
    CurrentValue = DEMON_COMBAT_ENABLED,
    Flag = "DemonCombat",
    Callback = function(Value)
        DEMON_COMBAT_ENABLED = Value
    end
})

-- Start combat loops
startSlayerCombat()
startDemonCombat()

-- üîπ 8Ô∏è‚É£ Notification
Rayfield:Notify({
    Title = "GURTHUB Loaded",
    Content = "ESP & Combat ready",
    Duration = 5,
    Image = 4483362458
})
